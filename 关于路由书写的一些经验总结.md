## 前言

`路由`这个概念，应该是在`单页应用`才出现的。是`单页应用`为了模拟传统`多页应用`而产生的。传统的前端网站，每个页面都是一个html文件，url描述了当前该页面相对与你服务器root目录的位置。所以，我们希望用户通过怎样的url来访问我们的页面，我们就要建立对应的目录，并将我们的页面放在该目录下。而`单页应用`，顾名思义只有一个页面。`单页应用`为了实现页面跳转，通过对url进行解析，动态渲染出不同的内容，从而让用户感觉到页面跳转的效果。而url中用于区分不同页面的部分，就称为`路由`。

## 路由的配置

既然`单页应用`打包后只有一个页面，只能通过解析URL来判断到底渲染哪个页面，那么偶们就必须要对`路由`进行配置，将不同url关联到我们写好的组件。

于是我们就会遇到一个世界级难题：如何起名。一是给组件起名，二是给路由起名。

因为每个人起名风格不太一样，英文水平也不太一样，所以经常见到路由名称五花八门，也没有层次区分。我呢，还是比较严谨的，首先我会按照业务逻辑，将相同功能的页面存放在同个目录，然后每个路由，都与页面文件的路径相同。

不过偶尔我也会出一些问题，比如说页面结构发生了重构，或者页面重命名了，路由就没来得及更新。很容易令人强迫症发作。

## 约定式路由

`约定式路由`，是最能还原`多页应用`的一种路由模式。它需要指定一个`pageRoot`，然后扫描里面的所有文件，根据目录+文件名的方式生成路由配置。

我第一次接触到`约定式路由`这个概念是使用`umijs`这个框架的时候。那个时候我好像学习React还不到半年。一开始对`约定式路由`比较抵触，主要是因为不熟。有时候创建了一个文件，但没有生成页面，不知道怎么回事。但是当你了解了`约定式路由`的运作流程之后，你就会非常喜欢它。

`umijs`的`约定式路由`是很自由的，所谓自由，就是它和`多页应用`的目录一样，目录名随便写，然后目录下的所有html文件，都能被访问。`约定式路由`，除了几个关键目录(如`models`和`components`)，也是随你怎么写，都会扫描目录中的所有组件文件。

## 添加约定式路由的限制条件

最早我接触`umijs`的项目，里面已经被添加了一些限制。最直接的就是限制了`路径中不允许出现大写字母`以及`只识别index.js文件`

一开始我并不是很理解这两个规则，但是后来，一直到现在，我都非常赞同这两个规则。我下面来解释一下这两个规则的必要。

`路径中不允许出现大写字母`这个规则很容易理解，因为约定式路由中，目录路径就等价于url。你去看看那些比较大型的站点，哪家url上的路径带大写字母的？当然主要原因还是Windows目录不区分大小写，如果是基于Windows的一些服务器，有可能是大小写不敏感的。所以url全小写就成了一种潜规则吧。如果目录包含多个单词，你可以考虑`kebab-case`命名。业界都是这么做的呀。

关于`只识别index.js文件`这条规则，就是说在`pageRoot`下，只有index.js文件才能够被识别。要支撑这个规则，需要有以下观点：

1. `React`中，`class`名称应该使用`PASCAL`命名规范，也就是大写字母开头的驼峰命名。(这是业界习惯)
2. `React`组件的文件名应该与`class`名称一致。(这是Java的习惯，在JS中延续这个习惯我觉得是非常有必要的)
3. 页面文件一般会带有样式文件(css/less)，这个样式文件的命名最好也应该和其关联组件命名一致。(你全部叫`styles.less`也不是不行。`umijs`默认开启`css-module`，命名规则的前缀就是你的文件名。我相信你不会希望在开发时调试样式的时候，看到的class名称都是`styles_xxxx`吧。一眼通过class看出来是哪个文件的样式，不香么？)
4. 如果满足第3点，当你页面多起来了，每个页面带一个样式文件，你总不希望他们堆在一起吧(比如`pageRoot`下：`HomePage.js`,`HomePage.less`,`TestPage.js`,`TestPage.less`,......)，那我们是不是应该建立一个目录存放它们呢？(`pages/home/HomePage.js`, `pages/home/HomePage.less`, `pages/test/TestPage.js`, ......)。
5. 如果满足第4点，你的路由就会变成`/home/HomePage`，很冗余对不对？因为第4点已经将所有页面资源，都拆分到独立的目录了，一个目录就代表一个页面。我希望我的路由是`/home`就足够了。于是唯一满足将`pages/home/HomePage.js`的路由生成为`/home`的方式，就只有在`home`目录下建立一个`index.js`，并在其中`export` `./HomePage.js`。

如果你能接受上面几个点的内容，你就会发现，只有`index.js`是路由的有效入口，其他名称的文件可以忽略了。

确实，按我上面说的做，很规范，代码结构很漂亮。但是有同学会吐槽说，以后我写一个页面，就必须建立一个目录+3个文件了(`index.js`, `Page.js`, `Page.less`)。
可是你不按我说的做，你创建页面至少也要写页面本体和样式啊。按我的做法只是多加了一个目录和一个只有两行代码的`index.js`而已。

不过就为了这，我还是做了一些工具：

- `cbd-cli`, 通过命令行的方式创建页面模板/组件模板等。
- `cbd-tools`, 一个VSCode插件，它是结合`cbd-cli`做的，在VSCode中通过界面快速创建页面模板/组件模板。
- `umi-plugin-cbd-ui`，这是一个`umijs@2`的运行时插件，能够在页面运行后动态弹出界面，创建页面模板/组件。

这些功能都是为了满足上述条件，又减少开发者操作而做的。

## 总结

主要就是想表达一下我在约定式路由的限制条件上面的看法。因为这个问题之前和很多人都讨论过。基本上大家都不能拿出比我更好的方案。所以我就记录一下。

当然关于`index.js`作为入口的这条规则，在`React`中是比较适用的，但是`Vue`就不一样了。`Vue`不满足上述任何一点，它不需要`class`组件，不需要独立的样式文件，所以不需要`只识别index`这样限制。当然，`不允许出现大写字母`的这条规则，我觉得还是可以考虑的。
